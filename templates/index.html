{% extends "base.html" %}

{% block content %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <title>charting python</title>
</head>
<body>
    <div class="col=8 offset-2 my-5">
        <div class="card">
            <div class="container-fluid">
                <canvas id="myChart"></canvas>
                <form method="GET">
                    <div class="date_query">
                        <input type="date" name="begin" format= 'dd/mm/yyyy' startDate= '-3d'>
                        <input type="submit" value="To Date" >
                    </div>
                </form>
                    
                <!--
                <input oninput="updateChart(this)" type="range" id="points" value="2" min="1" max="3">
                {% for prod in products %}
                    <div class="form-check form-switch form-check-inline">
                        <input class="form-check-input" type="checkbox" id="flexSwitchCheckDefault">
                        <label class="form-check-label" for="flexSwitchCheckDefault">{{prod.name}}</label>
                    </div>
                {% endfor %}
                -->

            </div>
        </div>
    </div>

    <script>

    const df_labels = {{df_labels|safe}};
    const labels = {{labels|safe}};
    const values = {{values|safe}};
    const other_model = {};
    const colors = [
                'rgba(134, 99, 132, 0.2)',
                'rgba(154, 162, 235, 0.2)',
                'rgba(25, 206, 86, 0.2)',
                'rgba(45, 192, 192, 0.2)',
                'rgba(253, 102, 255, 0.2)',
                'rgba(155, 159, 64, 0.2)'
            ]
    for (let i = 0; i < values.length; i++) {
        other_model[labels[i]] = values[i];
        }
    console.log(other_model);
    window.onload=function(){
    var ctx = document.getElementById("myChart");
    var myChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: df_labels,
            datasets: []
        },
        options: {
            plugins: {
                title: {
                    display: true,
                    text: 'Chart.js Bar Chart - Stacked'
                },
            },
            scales: {
                x: {
                    stacked: true,
                },
                y: {
                    stacked: true,
                    ticks: {
                        beginAtZero: true,
                    }
                },
            }
        }
    });
    var pointer = 0;
    for (product in other_model) {
        var newDataset = {
            label: product,
            data: [],
            /* TODO randomize colors for each product */
            backgroundColor: colors[Math.floor((Math.random() * colors.length)%colors.length)],
            borderColor: colors[Math.floor((Math.random() * colors.length)%colors.length)],
            // backgroundColor: colors.pop(),
            borderWidth: 3
            };
            for (value in other_model[product]) {
                newDataset.data.push(other_model[product][value]);
            }
            myChart.config.data.datasets.push(newDataset);
    }
    myChart.update();
    }
    </script>
    
</body>
</html>

{% endblock %}